#summary Discuss, document and implement the Flat file container

= Introduction =

A flat file container is a remedium class that is used for storing and retrieving data using flat files. It is necessary since the current HSQL implementation of the container is using an excessive amount of RAM.


There exist trade-offs about this approach:
  * When the file name becomes long then it is unreadable by humans
  * File contents might changes and differ from what is reported on the file name
  * This structure is limited to a single level of key-value pairs. Typical INI methods allow using INI sections
  * Some Operative Systems such as Windows will limit the max size of the file name to 256 characters
  * Malicious actors can tamper the file name or file contents
  * Additional time required to process records
  * Not a mature technique, will be prune to errors

And advantages:
  * Third-party providers can supply additional knowledge bases
  * End users can manage available knowledge by their own means
  * Reduced RAM usage
  * Expand supported storage to large scale management on normal workstations

The main driver to adopt flat files is the need to find a solution that avoids an excessive RAM consumption.

----

= Desired properties =

  * Allows to set the max number of records per data file
  * Least amount possible of data files
  * Quick to retrieve data
    * Should read a record from a DB with 100 000 records under an average of 0,05 seconds after 100 random record reads
  * Quick to store data
    * Should write onto a DB 100 000 records under 10 minutes
  * Scale up to millions of records
    * Should write a DB with 100 000 000 records and manage them
  * Memory efficient
    * Overall memory usage shouldn't surpass 30Mb regardless of DB size

----

= Nice to haves =

We can attempt to store a max of a million of records for each file, however, it would be particularly nice to allow other providers to add more data on a folder.

For example, we create a knowledge container with information gathered by someone about Microsoft Windows files and we include this knowledge inside our own container in a decentralized manner.

The big advantage is allowing providers to make available specialized knowledge about a given subject. 

People interested in updating the knowledge of their containers can do so manually. Despite primitive, it does bring the advantage of letting end-users manage updates and get them from other providers of their preference.


For this model of data exchange be possible, we can't enforce a specific folder structure but rather scan all files and subfolders to discover the type of information that each container is providing.



----

= Development approach =

I have recently implemented the Container Dump class that is basically dumping all records from an HSQL database onto flat files. The remarkable speed noted when importing and exporting these records are the main reason why this class is now being implemented.

Some of the code and lessons learned from the implementation of Container dump can now be applied to this new class. The page section "Desired properties" is a guideline of performance requirements on my development machine (Toshiba R-630 laptop, i5 CPU x64 with 4Gb of RAM under Windows 7). 

A test case is being developed along case with this class implementation to ensure that each method and step of this process is tested using a repetitive approach.

=== Identifying files with knowledge ===

Since under this model all files will be mixed and use a unknown folder structure, we are left with the challenge of identifying the contents of a given knowledge base flat file. We need to do this without reading the contents otherwise this method would become prohibitive to use when these files are numerous and large sized. 

To identify each file, we apply the concept of file name properties that was introduced with the Container Dump class where we add an identifier to the file name. We scan all files inside a given folder and subfolder

This way we scan files very quickly and in the process get file names that contain information about their respective contents.

File name information uses Key=Value approach as seen for INI files with no INI sections. There are two reserved characters:
  * {{{-}}} is equivalent to "="
  * {{{_}}} separates key-value pairs from each others

An example of this usage: 
{{{db-crc32_since-1309513994973_until-1309514033984_count-2307_checksum-6970388375f06a91f9b8f133697f94f2a1e0ed54ec1d64cebfb47f43595712bd_v-1.txt}}}
Note how we see different key-value pairs that allow extracting information from the file without needing to read the contents. 


----

= How it works =

We created an Interface class to the Container and this way it is possible to create implementation of the container using more technologies in the future other than just HSQL or Flat files.

== Constructor ==

The first step is invoking the constructor method:
{{{container = new ContainerFlatFile(id, fields, rootFolder, result);}}}

Where:
  * String *id* is the identification name of this container
  * String[] *fields* are the columns for our table 
  * File *rootFolder* is the folder where we are storing the containers 
  * LogMessage *result* is a log message object that contains details about this operation

 
=== Initial checks ===

We care to ensure that our *root folder* is valid and then we will check if we can create a sub folder with the same name as *id*.

If anything goes wrong, the *result* message will provide details and a specific value number under {{{result.getCode()}}} that you can use for debugging what has happened. 

----


= Progress =

30th June 2011
  * Initial implementation of new class
  * Introduced concept of log message object to allow testing the new class without tying it on a remedium component (allows testing exclusively the new class without interference from components)